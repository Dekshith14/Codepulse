{"ast":null,"code":"import _asyncToGenerator from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/regenerator/index.js\";// EditorPage.js\nimport React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Client from'../components/Client';import Editor from'../components/Editor';import{initSocket}from'../socket';import{useLocation,useNavigate,Navigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var socketRef=useRef(null);var codeRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),editingPermission=_useState4[0],setEditingPermission=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isCreator=_useState6[0],setIsCreator=_useState6[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _location$state,_location$state2;var handleErrors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){console.log('socket error',e);toast.error('Socket connection failed, try again later.');reactNavigator('/');};_context.next=3;return initSocket();case 3:socketRef.current=_context.sent;socketRef.current.on('connect_error',function(err){return handleErrors(err);});socketRef.current.on('connect_failed',function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username,editingPermission:(_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.editingPermission});socketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state3;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId,editingPermission=_ref2.editingPermission,isCreator=_ref2.isCreator;if(username!==((_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);setEditingPermission(editingPermission);setIsCreator(isCreator);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});// If the creator has editing permission, sync it with others\nif(isCreator&&editingPermission){socketRef.current.emit(ACTIONS.SYNC_EDIT_PERMISSION,{roomId:roomId,editingPermission:editingPermission});}});socketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 9:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success('Room ID has been copied to your clipboard');_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.error(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}function toggleEditingPermission(){// Allow the creator to toggle editing permission\nif(isCreator){var newPermission=!editingPermission;setEditingPermission(newPermission);socketRef.current.emit(ACTIONS.SYNC_EDIT_PERMISSION,{roomId:roomId,editingPermission:newPermission});}}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"editor-page\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logo-image\",src:\"/icon.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected Users\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clients-list\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copy-btn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leave-btn\",onClick:leaveRoom,children:\"Leave\"}),isCreator&&/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:toggleEditingPermission,children:editingPermission?'Revoke Edit Permission':'Grant Edit Permission'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editor-wrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;},readOnly:!editingPermission})})]});};export default EditorPage;","map":{"version":3,"sources":["/home/dheerajcl/Code-pulse/Codepulse/src/pages/EditorPage.js"],"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor","initSocket","useLocation","useNavigate","Navigate","useParams","EditorPage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","editingPermission","setEditingPermission","isCreator","setIsCreator","init","handleErrors","e","console","log","error","current","on","err","emit","JOIN","username","state","JOINED","socketId","success","SYNC_CODE","code","SYNC_EDIT_PERMISSION","DISCONNECTED","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","toggleEditingPermission","newPermission","map"],"mappings":"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","sourcesContent":["// EditorPage.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport ACTIONS from '../Actions';\nimport Client from '../components/Client';\nimport Editor from '../components/Editor';\nimport { initSocket } from '../socket';\nimport { useLocation, useNavigate, Navigate, useParams } from 'react-router-dom';\n\nconst EditorPage = () => {\n    const socketRef = useRef(null);\n    const codeRef = useRef(null);\n    const location = useLocation();\n    const { roomId } = useParams();\n    const reactNavigator = useNavigate();\n    const [clients, setClients] = useState([]);\n    const [editingPermission, setEditingPermission] = useState(false);\n    const [isCreator, setIsCreator] = useState(false);\n\n    useEffect(() => {\n        const init = async () => {\n            socketRef.current = await initSocket();\n            socketRef.current.on('connect_error', (err) => handleErrors(err));\n            socketRef.current.on('connect_failed', (err) => handleErrors(err));\n\n            function handleErrors(e) {\n                console.log('socket error', e);\n                toast.error('Socket connection failed, try again later.');\n                reactNavigator('/');\n            }\n\n            socketRef.current.emit(ACTIONS.JOIN, {\n                roomId,\n                username: location.state?.username,\n                editingPermission: location.state?.editingPermission,\n            });\n\n            socketRef.current.on(\n                ACTIONS.JOINED,\n                ({ clients, username, socketId, editingPermission, isCreator }) => {\n                    if (username !== location.state?.username) {\n                        toast.success(`${username} joined the room.`);\n                        console.log(`${username} joined`);\n                    }\n                    setClients(clients);\n                    setEditingPermission(editingPermission);\n                    setIsCreator(isCreator);\n                    socketRef.current.emit(ACTIONS.SYNC_CODE, {\n                        code: codeRef.current,\n                        socketId,\n                    });\n\n                    // If the creator has editing permission, sync it with others\n                    if (isCreator && editingPermission) {\n                        socketRef.current.emit(ACTIONS.SYNC_EDIT_PERMISSION, {\n                            roomId,\n                            editingPermission,\n                        });\n                    }\n                }\n            );\n\n            socketRef.current.on(\n                ACTIONS.DISCONNECTED,\n                ({ socketId, username }) => {\n                    toast.success(`${username} left the room.`);\n                    setClients((prev) => {\n                        return prev.filter(\n                            (client) => client.socketId !== socketId\n                        );\n                    });\n                }\n            );\n        };\n\n        init();\n\n        return () => {\n            socketRef.current.disconnect();\n            socketRef.current.off(ACTIONS.JOINED);\n            socketRef.current.off(ACTIONS.DISCONNECTED);\n        };\n    }, []);\n\n    async function copyRoomId() {\n        try {\n            await navigator.clipboard.writeText(roomId);\n            toast.success('Room ID has been copied to your clipboard');\n        } catch (err) {\n            toast.error('Could not copy the Room ID');\n            console.error(err);\n        }\n    }\n\n    function leaveRoom() {\n        reactNavigator('/');\n    }\n\n    function toggleEditingPermission() {\n        // Allow the creator to toggle editing permission\n        if (isCreator) {\n            const newPermission = !editingPermission;\n            setEditingPermission(newPermission);\n            socketRef.current.emit(ACTIONS.SYNC_EDIT_PERMISSION, {\n                roomId,\n                editingPermission: newPermission,\n            });\n        }\n    }\n\n    if (!location.state) {\n        return <Navigate to=\"/\" />;\n    }\n\n    return (\n        <div className=\"editor-page\">\n            <aside className=\"sidebar\">\n                <div className=\"logo\">\n                    <img className=\"logo-image\" src=\"/icon.png\" alt=\"logo\" />\n                </div>\n                <h3>Connected Users</h3>\n                <div className=\"clients-list\">\n                    {clients.map((client) => (\n                        <Client key={client.socketId} username={client.username} />\n                    ))}\n                </div>\n                <button className=\"btn copy-btn\" onClick={copyRoomId}>\n                    Copy ROOM ID\n                </button>\n                <button className=\"btn leave-btn\" onClick={leaveRoom}>\n                    Leave\n                </button>\n                {isCreator && (\n                    <button className=\"btn\" onClick={toggleEditingPermission}>\n                        {editingPermission ? 'Revoke Edit Permission' : 'Grant Edit Permission'}\n                    </button>\n                )}\n            </aside>\n            <div className=\"editor-wrap\">\n                <Editor\n                    socketRef={socketRef}\n                    roomId={roomId}\n                    onCodeChange={(code) => {\n                        codeRef.current = code;\n                    }}\n                    readOnly={!editingPermission}\n                />\n            </div>\n        </div>\n    );\n};\n\nexport default EditorPage;\n"]},"metadata":{},"sourceType":"module"}