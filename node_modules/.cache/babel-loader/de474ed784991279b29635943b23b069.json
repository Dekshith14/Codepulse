{"ast":null,"code":"import _asyncToGenerator from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/dheerajcl/Code-pulse/Codepulse/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Client from'../components/Client';import Editor from'../components/Editor';import{useLocation,useNavigate,Navigate,useParams}from'react-router-dom';import io from'socket.io-client';// Import the socket.io-client library\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var socketRef=useRef(null);var codeRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),editingPermission=_useState4[0],setEditingPermission=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isCreator=_useState6[0],setIsCreator=_useState6[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _location$state;var handleErrors,username;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){console.log('socket error',e);toast.error('Socket connection failed, try again later.');reactNavigator('/');};// Connect to the socket server\n// Connect to the socket server with WebSocket transport\nsocketRef.current=io('/',{transports:['websocket']});// Replace with your actual server URL\nsocketRef.current.on('connect_error',function(err){return handleErrors(err);});socketRef.current.on('connect_failed',function(err){return handleErrors(err);});username=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username;socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:username,editingPermission:editingPermission,isCreator:true});socketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId,editingPermission=_ref2.editingPermission,isCreator=_ref2.isCreator;if(username&&username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);setEditingPermission(editingPermission);setIsCreator(isCreator);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});socketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 8:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);// Add cleanup for other event listeners if necessary\n};},[location.state,reactNavigator,roomId]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success('Room ID has been copied to your clipboard');_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.error(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"editor-page\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logo-image\",src:\"/icon.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected Users\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clients-list\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn copy-btn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leave-btn\",onClick:leaveRoom,children:\"Leave\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editor-wrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;},isCreator:isCreator})})]});};export default EditorPage;","map":{"version":3,"sources":["/home/dheerajcl/Code-pulse/Codepulse/src/pages/EditorPage.js"],"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor","useLocation","useNavigate","Navigate","useParams","io","EditorPage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","editingPermission","setEditingPermission","isCreator","setIsCreator","init","handleErrors","e","console","log","error","current","transports","on","err","username","state","emit","JOIN","JOINED","socketId","success","SYNC_CODE","code","DISCONNECTED","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","map"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport ACTIONS from '../Actions';\nimport Client from '../components/Client';\nimport Editor from '../components/Editor';\nimport { useLocation, useNavigate, Navigate, useParams } from 'react-router-dom';\nimport io from 'socket.io-client'; // Import the socket.io-client library\n\nconst EditorPage = () => {\n  const socketRef = useRef(null);\n  const codeRef = useRef(null);\n  const location = useLocation();\n  const { roomId } = useParams();\n  const reactNavigator = useNavigate();\n  const [clients, setClients] = useState([]);\n  const [editingPermission, setEditingPermission] = useState(true);\n  const [isCreator, setIsCreator] = useState(false);\n\n  useEffect(() => {\n    const init = async () => {\n      // Connect to the socket server\n      // Connect to the socket server with WebSocket transport\nsocketRef.current = io('/', {\n  transports: ['websocket'],\n});\n // Replace with your actual server URL\n\n      socketRef.current.on('connect_error', (err) => handleErrors(err));\n      socketRef.current.on('connect_failed', (err) => handleErrors(err));\n\n      function handleErrors(e) {\n        console.log('socket error', e);\n        toast.error('Socket connection failed, try again later.');\n        reactNavigator('/');\n      }\n\n      const username = location.state?.username;\n      socketRef.current.emit(ACTIONS.JOIN, {\n        roomId,\n        username,\n        editingPermission,\n        isCreator: true,\n      });\n\n      socketRef.current.on(\n        ACTIONS.JOINED,\n        ({ clients, username, socketId, editingPermission, isCreator }) => {\n          if (username && username !== location.state?.username) {\n            toast.success(`${username} joined the room.`);\n            console.log(`${username} joined`);\n          }\n          setClients(clients);\n          setEditingPermission(editingPermission);\n          setIsCreator(isCreator);\n          socketRef.current.emit(ACTIONS.SYNC_CODE, {\n            code: codeRef.current,\n            socketId,\n          });\n        }\n      );\n\n      socketRef.current.on(\n        ACTIONS.DISCONNECTED,\n        ({ socketId, username }) => {\n          toast.success(`${username} left the room.`);\n          setClients((prev) => {\n            return prev.filter(\n              (client) => client.socketId !== socketId\n            );\n          });\n        }\n      );\n    };\n\n    init();\n\n    return () => {\n      socketRef.current.disconnect();\n      socketRef.current.off(ACTIONS.JOINED);\n      socketRef.current.off(ACTIONS.DISCONNECTED);\n      // Add cleanup for other event listeners if necessary\n    };\n  }, [location.state, reactNavigator, roomId]);\n\n  async function copyRoomId() {\n    try {\n      await navigator.clipboard.writeText(roomId);\n      toast.success('Room ID has been copied to your clipboard');\n    } catch (err) {\n      toast.error('Could not copy the Room ID');\n      console.error(err);\n    }\n  }\n\n  function leaveRoom() {\n    reactNavigator('/');\n  }\n\n  if (!location.state) {\n    return <Navigate to=\"/\" />;\n  }\n\n  return (\n    <div className=\"editor-page\">\n      <aside className=\"sidebar\">\n        <div className=\"logo\">\n          <img className=\"logo-image\" src=\"/icon.png\" alt=\"logo\" />\n        </div>\n        <h3>Connected Users</h3>\n        <div className=\"clients-list\">\n          {clients.map((client) => (\n            <Client key={client.socketId} username={client.username} />\n          ))}\n        </div>\n        <div className=\"button-container\">\n          <button className=\"btn copy-btn\" onClick={copyRoomId}>\n            Copy ROOM ID\n          </button>\n          <button className=\"btn leave-btn\" onClick={leaveRoom}>\n            Leave\n          </button>\n        </div>\n      </aside>\n      <div className=\"editor-wrap\">\n        <Editor\n          socketRef={socketRef}\n          roomId={roomId}\n          onCodeChange={(code) => {\n            codeRef.current = code;\n          }}\n          isCreator={isCreator}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default EditorPage;\n"]},"metadata":{},"sourceType":"module"}